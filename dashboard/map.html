---
layout: dashboard
title: Map
permalink: /admin/map/
---

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

<script src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>
<!-- script src="https://raw.github.com/shramov/leaflet-plugins/master/layer/tile/Google.js"></script -->
<script src="https://raw.github.com/shramov/leaflet-plugins/master/layer/Layer.Deferred.js"></script>


<link rel="stylesheet" href="/css/L.Control.Locate.css" />
<script src="/js/L.Control.Locate.js"></script>

Location: <code id="mapLocation"></code>
<hr />
<div id="map" style="height: 300px;"></div>
<script type="text/javascript">

var latlng = [51.505, -0.09];

var map = new L.Map('map', {center: latlng, zoom: 10, zoomAnimation: false });
var osm = new L.TileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

var layerdefs = {
	mapnik: { name: "Mapnik", js: [],
		init: function() {return new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');}},
	gmap: { name: "Google", js: ["https://raw.github.com/shramov/leaflet-plugins/master/layer/tile/Google.js", "http://maps.google.com/maps/api/js?v=3&sensor=false&callback=L.Google.asyncInitialize"],
		init: function() {return new L.Google('ROADMAP'); }},
	mso: { name: "Mapsurfer", js: [], overlay: true,
		init: function() {return new L.TileLayer('http://129.206.74.245:8003/tms_h.ashx?x={x}&y={y}&z={z}');}}
};

var google = new L.DeferredLayer(layerdefs.gmap);
var mso = new L.DeferredLayer(layerdefs.mso);

L.control.layers(
  {
    'OSM':osm,
    'Google':google,
  },{
    'OpenMapSurfer':mso
  }
).addTo(map);


// Marker
var marker = new L.marker(latlng, {draggable:'true'});
map.addLayer(marker);
// Controls

L.control.scale().addTo(map);

L.control.locate().addTo(map);

// Overlays

// var baseLayers = {
//     "OpenStreetMap": osm,
//     "CloudMade": cloudmade
// };
// var overlays = {
// };
// L.control.layers(baseLayers, overlays).addTo(map);


function positionToCode(p){
  var t = p.lat+", "+p.lng+" : "+map.getZoom()+"";
  $("#mapLocation").text(t);
}

// Events
marker.on('dragend', function(e){
        var marker = e.target;
        var position = marker.getLatLng();
        marker.setLatLng(position).update();
        positionToCode(position);
});

map.on('click', function(e){
  var position = e.latlng;
  marker.setLatLng(position).update();
  positionToCode(position);
});

map.on('zoomend', function(e){
  positionToCode(marker.getLatLng());
});


</script>
